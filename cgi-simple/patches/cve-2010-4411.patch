Author: Mark Stosberg <mark@stosberg.com>
Origin: http://github.com/markstos/CGI--Simple/commit/daff9ca164a7d88d68b6d4d729331e03e32d00dd
Origin: http://github.com/markstos/CGI--Simple/commit/e811ab874a5e0ac8a99e76b645a0e537d8f714da
Subject: [CVE-2010-4411] Port latest header-injection refinement from CGI.pm

See also http://www.openwall.com/lists/oss-security/2011/01/04/9

--- libcgi-simple-perl.orig/lib/CGI/Simple.pm
+++ libcgi-simple-perl/lib/CGI/Simple.pm
@@ -1007,7 +1007,7 @@
       $header =~ s/$CRLF(\s)/$1/g;
 
       # All other uses of newlines are invalid input.
-      if ( $header =~ m/$CRLF/ ) {
+      if ($header =~ m/$CRLF|\015|\012/) {
         # shorten very long values in the diagnostic
         $header = substr( $header, 0, 72 ) . '...'
          if ( length $header > 72 );
--- libcgi-simple-perl.orig/t/headers.t
+++ libcgi-simple-perl/t/headers.t
@@ -76,3 +76,9 @@
   'redirect with leading newlines blows up'
 );
 
+{
+    my $cgi = CGI::Simple->new('t=bogus%0A%0A<html>');
+    my $out;
+    eval { $out = $cgi->redirect( $cgi->param('t') ) };
+    like($@,qr/contains a newline/, "redirect does not allow double-newline injection");
+}
